# 实现自动保存与防丢机制方案

针对您提出的“页面刷新或卡顿时丢失未保存内容”的问题，我将实现一个**实时自动保存 (Auto-save)** 和 **草稿恢复 (Draft Recovery)** 机制。

## 核心目标
*   **输入即保存**：用户在任何输入框（计划项、主题选择、觉察内容）进行修改时，实时将数据保存到本地缓存。
*   **刷新不丢失**：即使未点击“提交复盘”，刷新页面后也能自动恢复刚才输入的内容。
*   **提交才上云**：为了减少云端请求频率，**实时保存仅在 LocalStorage 进行**；只有点击“提交复盘”按钮时，才同步到 Supabase。

## 实施步骤

### 1. 状态变更监听 (`useEffect`)
*   监听所有表单状态的变化：`todayPlans`, `tomorrowPlans`, `mainTheme`, `mainThemeNote`, `subTheme`, `subThemeNote`。
*   使用 `useEffect` 钩子，当上述任何状态发生改变时，触发保存逻辑。

### 2. 防抖处理 (Debounce)
*   为了避免每次按键都触发写入操作（影响性能），我们将引入 **防抖 (Debounce)** 机制。
*   设置 500ms 或 1000ms 的延迟，只有用户停止输入一段时间后，才执行写入 LocalStorage 的操作。

### 3. 数据加载逻辑优化
*   修改初始化逻辑 (`initData`)：
    *   在加载数据时，优先读取 LocalStorage 中的最新数据（即使它还没同步到云端）。
    *   如果 LocalStorage 中有数据且比云端数据新（或云端无数据），则使用 LocalStorage 数据，确保未提交的草稿能被恢复。

### 4. 提交逻辑微调
*   点击“提交复盘”时，除了同步到 Supabase，还会更新 LocalStorage 中的数据，并标记为“已同步”状态（可选，目前只需确保最新数据在两端一致即可）。

## 预期效果
*   您正在输入“明日计划”时，突然刷新页面。
*   重新加载后，刚才输入的文字依然存在，完全无感。

请确认是否同意实施此方案？确认后我将立即为您修改代码。