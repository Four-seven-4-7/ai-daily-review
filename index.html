<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://cdn.staticfile.net">
    <title>æ¯æ—¥ç»“æ„åŒ–å¤ç›˜</title>
    <!-- æ ¸å¿ƒåº“ (å…¨éƒ¨ä½¿ç”¨å›½å†…é«˜é€Ÿé•œåƒ) -->
    <script src="https://lib.baomitu.com/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://lib.baomitu.com/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://lib.baomitu.com/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://lib.baomitu.com/dayjs/1.11.10/dayjs.min.js"></script>
    <!-- Ant Design -->
    <link rel="stylesheet" href="https://lib.baomitu.com/antd/5.14.0/reset.min.css">
    <script src="https://lib.baomitu.com/antd/5.14.0/antd.min.js"></script>
    <script src="https://lib.baomitu.com/ant-design-icons/5.2.6/index.umd.min.js"></script>
    <!-- Supabase -->
    <script src="https://lib.baomitu.com/supabase-js/2.39.3/supabase-js.min.js"></script>
    
    <style>
        body { background-color: #fffbe6; padding: 20px; margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; }
        .skeleton-loader { max-width: 800px; margin: 0 auto; padding: 24px; background: #fff; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .skeleton-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .skeleton-title { width: 200px; height: 32px; background: #f0f0f0; border-radius: 4px; }
        .skeleton-btn { width: 80px; height: 32px; background: #f0f0f0; border-radius: 4px; }
        .skeleton-block { height: 120px; background: #f5f5f5; margin-bottom: 20px; border-radius: 8px; }
        .skeleton-line { height: 40px; background: #f5f5f5; margin-bottom: 15px; border-radius: 4px; }
        @keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }
        .skeleton-loader * { animation: pulse 1.5s ease-in-out infinite; }
        #root:empty { display: none; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 24px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .section-title { margin-top: 24px; margin-bottom: 16px; font-weight: bold; font-size: 16px; border-left: 4px solid #fa8c16; padding-left: 8px; color: #595959; }
        .plan-item { display: flex; align-items: flex-start; margin-bottom: 8px; gap: 8px; }
        .plan-item .ant-checkbox-wrapper { margin-top: 5px; }
        .history-item:hover { background-color: #fff7e6; transition: background-color 0.3s; cursor: pointer; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <div class="skeleton-loader" id="static-skeleton">
        <div class="skeleton-header">
            <div class="skeleton-title"></div>
            <div style="display:flex; gap:10px"><div class="skeleton-btn"></div><div class="skeleton-btn"></div></div>
        </div>
        <div class="skeleton-line" style="width: 150px;"></div>
        <div class="skeleton-block"></div>
        <div class="skeleton-line" style="width: 200px;"></div>
        <div class="skeleton-block"></div>
    </div>

    <!-- é”™è¯¯å¤„ç†è„šæœ¬ -->
    <script>
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            const isReactError = msg.indexOf('ReactDOM is not defined') > -1 || msg.indexOf('React is not defined') > -1;
            const isSupabaseError = msg.indexOf('supabase') > -1 && msg.indexOf('not defined') > -1;
            
            if (isReactError || isSupabaseError) {
                const root = document.getElementById('root');
                root.innerHTML = `
                    <div style="padding: 20px; text-align: center; background: white; margin: 20px; border-radius: 8px; border: 1px solid #ffa39e;">
                        <h3 style="color: #cf1322;">é¡µé¢åŠ è½½å¤±è´¥</h3>
                        <p>ç”±äºç½‘ç»œé™åˆ¶æˆ–æµè§ˆå™¨å®‰å…¨è®¾ç½®ï¼ˆå¦‚â€œè·Ÿè¸ªé˜²æŠ¤â€ï¼‰ï¼Œæ ¸å¿ƒåº“åŠ è½½å¤±è´¥ã€‚</p>
                        <p style="font-size: 14px; color: #666;">å½“å‰æŠ¥é”™ï¼š${msg}</p>
                        <p style="font-size: 14px; color: #666;">å»ºè®®ï¼šè¯·å°è¯•å…³é—­æµè§ˆå™¨çš„â€œè·Ÿè¸ªé˜²æŠ¤â€æˆ–ä½¿ç”¨ Chrome æµè§ˆå™¨æ‰“å¼€ã€‚</p>
                        <button onclick="location.reload()" style="padding: 8px 16px; background: #fa8c16; color: white; border: none; border-radius: 4px; cursor: pointer;">é‡æ–°åŠ è½½</button>
                    </div>
                `;
                const skeleton = document.getElementById('static-skeleton');
                if (skeleton) skeleton.style.display = 'none';
            }
            return false;
        };
    </script>

    <script type="text/babel">
        // æ ¸å¿ƒçº é”™ï¼šç¡®ä¿åº“å·²åŠ è½½
        const Icons = window.icons || {};
        const { SettingOutlined, HistoryOutlined, ExportOutlined, PlusOutlined, DeleteOutlined, CheckCircleOutlined, LeftOutlined, RightOutlined, CloudDownloadOutlined } = Icons;

        const { useState, useEffect, useMemo, useRef } = React;
        const { Button, Input, Checkbox, Select, message, Typography, Card, Empty, Modal, List, Tag, DatePicker, Progress, Space, Spin, Tooltip } = antd;
        const { Title, Text } = Typography;
        const { TextArea } = Input;

        // --- Config ---
        const SUPABASE_URL = 'https://usytwmlxzyzryzwwfzig.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVzeXR3bWx4enl6cnl6d3dmemlnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2OTAyNjQsImV4cCI6MjA4NTI2NjI2NH0.ZIqSJZN91Ncu5FGCp4kwHjrOR-2hWeGjVtPiBsTWqCY';
        const STORAGE_KEY_PREFIX = 'daily_review_';
        const META_KEY = 'daily_review_meta';
        const THEMES_KEY = 'daily_review_themes';
        const DEFAULT_THEMES = ["å·¥ä½œ/äº‹ä¸š", "ä¸ªäººæˆé•¿", "å¥åº·/è¿åŠ¨", "å®¶åº­/å…³ç³»", "è´¢åŠ¡/ç†è´¢", "ä¼‘é—²/å¨±ä¹", "ç¤¾äº¤/äººè„‰", "ç²¾ç¥/çµæ€§"];

        // --- Hooks ---
        const useDebounce = (value, delay) => {
            const [debouncedValue, setDebouncedValue] = useState(value);
            useEffect(() => {
                const handler = setTimeout(() => setDebouncedValue(value), delay);
                return () => clearTimeout(handler);
            }, [value, delay]);
            return debouncedValue;
        };

        // --- Services ---
        const getDeviceId = () => {
            let id = localStorage.getItem('daily_review_device_id');
            if (!id) {
                // ç”Ÿæˆç¬¦åˆ UUID v4 æ ¼å¼çš„éšæœºå­—ç¬¦ä¸²ï¼Œç¡®ä¿æ•°æ®åº“èƒ½å¤Ÿæ¥å—
                id = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                    return v.toString(16);
                });
                localStorage.setItem('daily_review_device_id', id);
            }
            return id;
        };

        const supabaseService = {
            getClient() {
                // å…¼å®¹ä¸åŒçš„ CDN å¯¼å‡ºåç§°
                const sb = window.supabase || window.Supabase;
                if (sb) return sb;
                console.error('Supabase SDK not loaded - available globals:', Object.keys(window).filter(k => k.toLowerCase().includes('supabase')));
                return null;
            },
            async saveReview(date, data) {
                try {
                    const sb = this.getClient();
                    if (!sb) throw new Error('äº‘ç«¯æœåŠ¡æœªå°±ç»ª(SDKåŠ è½½å¤±è´¥)');
                    const client = sb.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                    return await client.from('daily_reviews').upsert({ 
                        date, user_id: getDeviceId(), content: data, updated_at: new Date().toISOString() 
                    }, { onConflict: 'date,user_id' });
                } catch(e) { return { error: e }; }
            },
            async getReview(date) {
                try {
                    const sb = this.getClient();
                    if (!sb) throw new Error('äº‘ç«¯æœåŠ¡æœªå°±ç»ª');
                    const client = sb.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                    const { data, error } = await client.from('daily_reviews').select('*').eq('date', date).eq('user_id', getDeviceId()).maybeSingle();
                    return { data: data?.content, error };
                } catch(e) { return { error: e }; }
            },
            async getAllReviews() {
                try {
                    const sb = this.getClient();
                    if (!sb) throw new Error('äº‘ç«¯æœåŠ¡æœªå°±ç»ª');
                    const client = sb.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                    const { data, error } = await client.from('daily_reviews').select('*').eq('user_id', getDeviceId()).order('date', { ascending: false });
                    return { data: data?.map(d => d.content), error };
                } catch(e) { return { error: e }; }
            }
        };

        // --- Components ---
        const PlanList = ({ title, items, onChange, isTomorrow = false }) => {
            const updateItem = (id, field, value) => {
                onChange(items.map(i => i.id === id ? { ...i, [field]: value } : i));
            };
            return (
                <div>
                    <div className="section-title">{title}</div>
                    {items.map(item => (
                        <div key={item.id} className="plan-item">
                            {!isTomorrow && <Checkbox checked={item.done} onChange={e => updateItem(item.id, 'done', e.target.checked)} />}
                            <div style={{ flex: 1, display: 'flex', flexDirection: 'column', gap: 4 }}>
                                <Input value={item.text} placeholder={isTomorrow ? "è¾“å…¥æ˜æ—¥è®¡åˆ’..." : "äº‹é¡¹å†…å®¹"} onChange={e => updateItem(item.id, 'text', e.target.value)} />
                                {!isTomorrow && <Input size="small" placeholder="å¤‡æ³¨" value={item.note || ''} onChange={e => updateItem(item.id, 'note', e.target.value)} style={{ color: '#666' }} />}
                            </div>
                            {isTomorrow && <Button type="text" danger onClick={() => onChange(items.filter(i => i.id !== item.id))} icon={<DeleteOutlined />} />}
                        </div>
                    ))}
                    {isTomorrow && <Button type="dashed" block onClick={() => onChange([...items, {id: Date.now().toString(), text: '', done: false, note: ''}])} icon={<PlusOutlined />}>æ·»åŠ äº‹é¡¹</Button>}
                    {!isTomorrow && items.length === 0 && <Empty description="ä»Šæ—¥æš‚æ— è®¡åˆ’" image={Empty.PRESENTED_IMAGE_SIMPLE} />}
                </div>
            );
        };

        const App = () => {
            const [loading, setLoading] = useState(true);
            const [syncLoading, setSyncLoading] = useState(false);
            const [currentDate, setCurrentDate] = useState(dayjs().format('YYYY-MM-DD'));
            
            const [todayPlans, setTodayPlans] = useState([]);
            const [tomorrowPlans, setTomorrowPlans] = useState([]);
            const [mainTheme, setMainTheme] = useState(null);
            const [mainThemeNote, setMainThemeNote] = useState('');
            const [subTheme, setSubTheme] = useState(null);
            const [subThemeNote, setSubThemeNote] = useState('');
            const [themes, setThemes] = useState(DEFAULT_THEMES);
            const [isAutoSaving, setIsAutoSaving] = useState(false);
            const [isHistoryOpen, setIsHistoryOpen] = useState(false);
            const [historyList, setHistoryList] = useState([]);
            const [isSettingsOpen, setIsSettingsOpen] = useState(false);
            const [newThemeInput, setNewThemeInput] = useState('');
            const [status, setStatus] = useState('å°±ç»ª');

            const completionRate = useMemo(() => {
                if (todayPlans.length === 0) return 0;
                return Math.round((todayPlans.filter(p => p.done).length / todayPlans.length) * 100);
            }, [todayPlans]);

            const formData = useMemo(() => ({
                date: currentDate, todayPlans, tomorrowPlans, mainTheme, mainThemeNote, subTheme, subThemeNote, updatedAt: Date.now()
            }), [currentDate, todayPlans, tomorrowPlans, mainTheme, mainThemeNote, subTheme, subThemeNote]);

            const debouncedFormData = useDebounce(formData, 1000);
            const isInitialLoad = useRef(true);
            const lastLoadedDataStr = useRef('');

            // Auto-save logic
            useEffect(() => {
                if (isInitialLoad.current || loading) return;
                const { updatedAt: _u1, ...currentContent } = debouncedFormData;
                let startContent = {};
                try { startContent = JSON.parse(lastLoadedDataStr.current || '{}'); delete startContent.updatedAt; } catch(e) {}
                
                if (JSON.stringify(currentContent) === JSON.stringify(startContent)) return;

                setIsAutoSaving(true);
                localStorage.setItem(STORAGE_KEY_PREFIX + currentDate, JSON.stringify(debouncedFormData));
                if (currentDate === dayjs().format('YYYY-MM-DD')) {
                    localStorage.setItem(META_KEY, JSON.stringify({ lastMainTheme: mainTheme, lastSubTheme: subTheme }));
                }
                setTimeout(() => setIsAutoSaving(false), 800);
            }, [debouncedFormData]);

            // Init data
            useEffect(() => {
                const init = async () => {
                    setLoading(true);
                    isInitialLoad.current = true;
                    
                    // Reset
                    setTodayPlans([]); setTomorrowPlans([]); setMainTheme(null); setMainThemeNote(''); setSubTheme(null); setSubThemeNote('');
                    
                    const savedThemes = localStorage.getItem(THEMES_KEY);
                    if (savedThemes) setThemes(JSON.parse(savedThemes));

                    const localStr = localStorage.getItem(STORAGE_KEY_PREFIX + currentDate);
                    if (localStr) {
                        const d = JSON.parse(localStr);
                        setTodayPlans(d.todayPlans || []); setTomorrowPlans(d.tomorrowPlans || []);
                        setMainTheme(d.mainTheme || null); setMainThemeNote(d.mainThemeNote || '');
                        setSubTheme(d.subTheme || null); setSubThemeNote(d.subThemeNote || '');
                        lastLoadedDataStr.current = localStr;
                    } else {
                        // Inheritance
                        const keys = Object.keys(localStorage).filter(k => k.startsWith(STORAGE_KEY_PREFIX)).map(k => k.replace(STORAGE_KEY_PREFIX, '')).filter(d => d < currentDate).sort().reverse();
                        if (keys.length > 0) {
                            const lastData = JSON.parse(localStorage.getItem(STORAGE_KEY_PREFIX + keys[0]));
                            if (lastData.tomorrowPlans) setTodayPlans(lastData.tomorrowPlans.map(p => ({ ...p, id: Date.now() + Math.random(), done: false, note: '' })));
                        }
                        const meta = JSON.parse(localStorage.getItem(META_KEY) || '{}');
                        if (meta.lastMainTheme) setMainTheme(meta.lastMainTheme);
                        if (meta.lastSubTheme) setSubTheme(meta.lastSubTheme);
                        lastLoadedDataStr.current = JSON.stringify({});
                    }

                    const skeleton = document.getElementById('static-skeleton');
                    if (skeleton) {
                        skeleton.style.display = 'none';
                        // è§£å†³ aria-hidden è­¦å‘Šï¼šç¡®ä¿åœ¨éšè—éª¨æ¶å±æ—¶ç§»é™¤å¯èƒ½å­˜åœ¨çš„ç„¦ç‚¹å†²çª
                        if (document.activeElement && document.activeElement !== document.body) {
                            document.activeElement.blur();
                        }
                    }
                    setLoading(false);
                    const isCloudReady = !!window.supabase;
                    setStatus(isCloudReady ? 'æœ¬åœ°æ•°æ®å·²å°±ç»ª' : 'æœ¬åœ°å°±ç»ª(äº‘ç«¯æœåŠ¡æœªè¿æ¥)');
                    setTimeout(() => isInitialLoad.current = false, 500);
                };
                init();
            }, [currentDate]);

            const handleSave = async () => {
                const data = { ...formData, updatedAt: Date.now() };
                // 1. ç«‹å³å­˜æœ¬åœ°ï¼Œæ— å»¶è¿Ÿ
                localStorage.setItem(STORAGE_KEY_PREFIX + currentDate, JSON.stringify(data));
                lastLoadedDataStr.current = JSON.stringify(data);
                
                // 2. é™é»˜åå°åŒæ­¥ï¼Œä¸æ˜¾ç¤ºé®ç½©ï¼Œä¸é˜»å¡UI
                setSyncLoading(true); 
                setStatus('äº‘ç«¯åŒæ­¥ä¸­...');
                
                supabaseService.saveReview(currentDate, data).then(({ error }) => {
                    setSyncLoading(false);
                    if (error) {
                        console.warn('Cloud sync failed', error);
                        setStatus('åŒæ­¥å¤±è´¥(å·²å­˜æœ¬åœ°)');
                    } else {
                        setStatus('å·²åŒæ­¥è‡³äº‘ç«¯ ' + dayjs().format('HH:mm:ss'));
                    }
                });
            };

            const handlePull = async () => {
                setStatus('æ­£åœ¨å°è¯•ä»äº‘ç«¯è·å–...');
                setSyncLoading(true);
                const { data, error } = await supabaseService.getReview(currentDate);
                setSyncLoading(false);
                
                if (error) {
                    setStatus('åŒæ­¥å¤±è´¥');
                    message.error('æ— æ³•è¿æ¥åˆ°äº‘ç«¯');
                }
                else if (!data) {
                    setStatus('äº‘ç«¯æ— æ­¤æ—¥æœŸæ•°æ®');
                    message.info('äº‘ç«¯æš‚æ— è¯¥æ—¥æœŸæ•°æ®');
                }
                else {
                    Modal.confirm({
                        title: 'ç¡®è®¤ä»äº‘ç«¯è¦†ç›–æœ¬åœ°?',
                        content: 'è¿™ä¼šæ›¿æ¢æ‚¨å½“å‰åœ¨é¡µé¢ä¸Šçœ‹åˆ°çš„å†…å®¹ã€‚',
                        onOk: () => {
                            setTodayPlans(data.todayPlans || []); 
                            setTomorrowPlans(data.tomorrowPlans || []);
                            setMainTheme(data.mainTheme || null); 
                            setMainThemeNote(data.mainThemeNote || '');
                            setSubTheme(data.subTheme || null); 
                            setSubThemeNote(data.subThemeNote || '');
                            localStorage.setItem(STORAGE_KEY_PREFIX + currentDate, JSON.stringify(data));
                            lastLoadedDataStr.current = JSON.stringify(data);
                            setStatus('äº‘ç«¯è¦†ç›–æˆåŠŸ');
                        }
                    });
                }
            };

            const loadHistory = async () => {
                const { data } = await supabaseService.getAllReviews();
                let list = data || [];
                if (list.length === 0) {
                    list = Object.keys(localStorage).filter(k => k.startsWith(STORAGE_KEY_PREFIX)).map(k => JSON.parse(localStorage.getItem(k))).sort((a,b) => b.date.localeCompare(a.date));
                }
                setHistoryList(list);
                setIsHistoryOpen(true);
            };

            const exportData = () => {
                const all = Object.keys(localStorage).filter(k => k.startsWith(STORAGE_KEY_PREFIX)).map(k => JSON.parse(localStorage.getItem(k)));
                const blob = new Blob([JSON.stringify(all, null, 2)], { type: 'application/json' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = `review_backup_${currentDate}.json`;
                a.click();
            };

            return (
                <div className="container">
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 20 }}>
                        <Title level={3} style={{ margin: 0 }}>ğŸ“… æ¯æ—¥ç»“æ„åŒ–å¤ç›˜</Title>
                        <Space>
                            {isAutoSaving && <Text type="secondary" style={{ fontSize: 12 }}><Spin size="small" /> è‡ªåŠ¨ä¿å­˜ä¸­...</Text>}
                            <Text type="secondary" style={{ fontSize: 12, marginRight: 10 }}>{status}</Text>
                            <Button icon={<CloudDownloadOutlined />} onClick={handlePull} loading={syncLoading}>äº‘ç«¯æ‹‰å–</Button>
                            <Button icon={<SettingOutlined />} onClick={() => setIsSettingsOpen(true)}>è®¾ç½®</Button>
                            <Button icon={<ExportOutlined />} onClick={exportData}>å¯¼å‡º</Button>
                            <Button icon={<HistoryOutlined />} onClick={loadHistory} type="primary" ghost>å†å²</Button>
                        </Space>
                    </div>

                    <div style={{ background: '#fff7e6', padding: 16, borderRadius: 8, marginBottom: 20, display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                        <Space>
                            <Button icon={<LeftOutlined />} onClick={() => setCurrentDate(dayjs(currentDate).subtract(1, 'day').format('YYYY-MM-DD'))} />
                            <DatePicker value={dayjs(currentDate)} onChange={d => setCurrentDate(d.format('YYYY-MM-DD'))} allowClear={false} />
                            <Button icon={<RightOutlined />} onClick={() => setCurrentDate(dayjs(currentDate).add(1, 'day').format('YYYY-MM-DD'))} />
                        </Space>
                        <Progress type="circle" percent={completionRate} size={40} strokeColor={completionRate === 100 ? '#52c41a' : '#fa8c16'} />
                    </div>

                    <Spin spinning={loading}>
                        <PlanList title="1. ä»Šæ—¥è®¡åˆ’å®Œæˆæƒ…å†µ" items={todayPlans} onChange={setTodayPlans} />
                        <PlanList title="2. æ˜æ—¥è®¡åˆ’äº‹é¡¹" items={tomorrowPlans} onChange={setTomorrowPlans} isTomorrow />
                        
                        <div className="section-title">3. ä¸»é¢˜è§‰å¯Ÿ</div>
                        <div style={{ marginBottom: 16 }}>
                            <Text strong>ä¸»ä¸»é¢˜</Text>
                            <Select style={{ width: '100%', margin: '8px 0' }} options={themes.map(t=>({label:t,value:t}))} value={mainTheme} onChange={setMainTheme} placeholder="é€‰æ‹©ä¸»ä¸»é¢˜" allowClear />
                            <TextArea rows={3} placeholder="è¾“å…¥ä¸»ä¸»é¢˜æ„Ÿæ‚Ÿ..." value={mainThemeNote} onChange={e => setMainThemeNote(e.target.value)} />
                        </div>
                        <div style={{ marginBottom: 16 }}>
                            <Text strong>å‰¯ä¸»é¢˜</Text>
                            <Select style={{ width: '100%', margin: '8px 0' }} options={themes.map(t=>({label:t,value:t}))} value={subTheme} onChange={setSubTheme} placeholder="é€‰æ‹©å‰¯ä¸»é¢˜" allowClear />
                            <TextArea rows={3} placeholder="è¾“å…¥å‰¯ä¸»é¢˜æ„Ÿæ‚Ÿ..." value={subThemeNote} onChange={e => setSubThemeNote(e.target.value)} />
                        </div>

                        <Button type="primary" block size="large" onClick={handleSave} style={{ marginTop: 24, height: 50, fontSize: 18 }} icon={<CheckCircleOutlined />}>æäº¤å¤ç›˜</Button>
                    </Spin>

                    <Modal title="å†å²è®°å½•" open={isHistoryOpen} onCancel={() => setIsHistoryOpen(false)} footer={null}>
                        <List dataSource={historyList} renderItem={item => (
                            <List.Item className="history-item" onClick={() => { setCurrentDate(item.date); setIsHistoryOpen(false); }}>
                                <div style={{ width: '100%' }}>
                                    <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                                        <Text strong>{item.date}</Text>
                                        <Tag color="orange">{item.mainTheme}</Tag>
                                    </div>
                                    <Text type="secondary" size="small">å®Œæˆç‡: {Math.round((item.todayPlans?.filter(p=>p.done).length / (item.todayPlans?.length || 1)) * 100)}%</Text>
                                </div>
                            </List.Item>
                        )} />
                    </Modal>

                    <Modal title="ä¸»é¢˜è®¾ç½®" open={isSettingsOpen} onCancel={() => setIsSettingsOpen(false)} onOk={() => setIsSettingsOpen(false)}>
                        <div style={{ display: 'flex', gap: 8, marginBottom: 16 }}>
                            <Input placeholder="æ–°ä¸»é¢˜" value={newThemeInput} onChange={e => setNewThemeInput(e.target.value)} onPressEnter={() => { if(newThemeInput) { const nt = [...themes, newThemeInput]; setThemes(nt); localStorage.setItem(THEMES_KEY, JSON.stringify(nt)); setNewThemeInput(''); } }} />
                            <Button type="primary" onClick={() => { if(newThemeInput) { const nt = [...themes, newThemeInput]; setThemes(nt); localStorage.setItem(THEMES_KEY, JSON.stringify(nt)); setNewThemeInput(''); } }}>æ·»åŠ </Button>
                        </div>
                        <Space wrap>{themes.map(t => <Tag key={t} closable onClose={() => { const nt = themes.filter(x => x !== t); setThemes(nt); localStorage.setItem(THEMES_KEY, JSON.stringify(nt)); }}>{t}</Tag>)}</Space>
                    </Modal>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<antd.ConfigProvider theme={{ token: { colorPrimary: '#fa8c16' } }}><App /></antd.ConfigProvider>);
    </script>
</body>
</html>